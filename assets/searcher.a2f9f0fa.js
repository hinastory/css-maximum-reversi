(function(){"use strict";const M=[[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1]],k=(t,e,n)=>{const[l,s]=[e%8,Math.floor(e/8)];let o=0;return M.forEach(([r,c])=>{let[a,f]=[l,s],u=0;for(;;){[a,f]=[a+r,f+c];let i=0;if(a<0||a>7||f<0||f>7||(i=n[f][a],i<=0)){u=0;break}else if(i==t)break;u++}[a,f]=[l,s],o+=u;for(let i=0;i<u;i++)[a,f]=[a+r,f+c],n[f][a]=t}),o==0?[!1,[[]]]:[!0,n]},E=(t=>[0,1,2,3,3,2,1,0].map(e=>[t[e],t[e].slice().reverse()]).flat().flat())([[50,-12,0,-1],[-12,-15,-3,-3],[0,-3,0,-1],[-1,-3,-1,-1]]),v=t=>t%2+1,g=t=>{const e=[];for(const n of t)e.push([...n]);return e},V=(t,e)=>{let n=0;const l=e.flat(),s=v(t);return E.forEach((o,r)=>{const c=l[r];n+=c==t?o:c==s?-o:0}),n},b=(t,e)=>{const n=[[[0,0],[0,1],[1,0]],[[7,0],[-1,0],[0,1]],[[0,7],[0,-1],[1,0]],[[7,7],[-1,0],[0,-1]]];let l=0;for(let s=0;s<4;s++){const o=n[s],r=o[0],c=e[r[1]][r[0]];if(c!=0)for(let a=0;a<2;a++){const f=o[a+1];let u=r[0],i=r[1],d=0;for(let p=0;p<8&&e[i][u]==c;p++)d+=1,[u,i]=[u+f[0],i+f[1]];c==t?l+=d:l-=d}}return l},x=(t,e)=>{const n=V(t,e),l=h(t,e).length,s=b(t,e),o=e.flat().filter(r=>r==0).length/64;return n+l*o*1.5+s*o*2},C=(t,e)=>{const n=[],l=v(t);for(let s=0;s<8;s++)for(let o=0;o<8;o++)if(e[o][s]==0)for(let r=0;r<M.length;r++){let[c,a]=M[r],[f,u]=[s+c,o+a];if(!(f<0||f>7||u<0||u>7)&&e[u][f]==l){n.push(s+o*8);break}}return n},h=(t,e)=>{const n=g(e),l=C(t,n),s=[];for(const o of l){const r=g(e),[c,a]=k(t,o,r);c&&s.push([o,a])}return s},y=(t,e,n)=>{const{turn:l,level:s,matrix:o}=t;if(s<=0)return[x(l,o),-1,[[]],[]];const r=h(l,o);if(r.length==0){const[c,,]=y({turn:v(l),level:s-1,matrix:o},-n,-e);return[-c,-1,[[]],[]]}else{let c=e,a=[[]],f=999999;for(const[u,i]of r){const d=g(i),[p,w]=[u%8,Math.floor(u/8)];d[w][p]=l;const[P,,]=y({turn:v(l),level:s-1,matrix:d},-n,-c),m=-P;if(m>e&&(c=m,a=d,f=u),e>=n)return[c,f,a]}return[c,f,a]}};self.addEventListener("message",t=>{if(t.data.type=="best"){const e=y(t.data.data,-99999,99999);self.postMessage({type:"best",data:e})}else if(t.data.type=="candidate"){const{turn:e,matrix:n}=t.data.data,l=h(e,n),s=[];for(const o of l)s.push(o[0]);self.postMessage({type:"candidate",data:s})}})})();
